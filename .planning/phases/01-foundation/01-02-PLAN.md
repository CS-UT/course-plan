---
phase: 01-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/CourseSearch.tsx
  - src/components/WeeklySchedule.tsx
  - src/components/ScheduleTabs.tsx
  - src/components/ExportButtons.tsx
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "Each of the 7 target elements has a data-tour attribute matching the selector in steps.ts"
    - "data-tour attributes are on stable wrapper elements, not on FullCalendar internals"
    - "Adding data-tour attributes does not change any visible behavior or layout"
    - "Build and type-check pass after attribute additions"
    - "driver.js CSS renders correctly in both light and dark mode (visually verified)"
    - "driver.js popovers display correctly in RTL layout (visually verified)"
  artifacts:
    - path: "src/components/CourseSearch.tsx"
      provides: "data-tour='course-search' on outermost div"
      contains: 'data-tour="course-search"'
    - path: "src/components/WeeklySchedule.tsx"
      provides: "data-tour='calendar' on outermost wrapper div"
      contains: 'data-tour="calendar"'
    - path: "src/components/ScheduleTabs.tsx"
      provides: "data-tour='schedule-tabs' on outermost div"
      contains: 'data-tour="schedule-tabs"'
    - path: "src/components/ExportButtons.tsx"
      provides: "data-tour='export-buttons' on outermost div"
      contains: 'data-tour="export-buttons"'
    - path: "src/App.tsx"
      provides: "data-tour attributes on mobile FAB, exams toggle, and dark mode toggle"
      contains: 'data-tour="mobile-add-btn"'
  key_links:
    - from: "src/components/onboarding/steps.ts"
      to: "src/components/CourseSearch.tsx"
      via: "targetSelector matches data-tour attribute"
      pattern: 'data-tour="course-search"'
    - from: "src/components/onboarding/steps.ts"
      to: "src/App.tsx"
      via: "targetSelector matches data-tour attributes"
      pattern: 'data-tour="(mobile-add-btn|exams-toggle|dark-mode)"'
---

<objective>
Add data-tour attributes to 7 target elements across 5 component files, then visually verify the complete Phase 1 infrastructure (CSS overrides, dark mode, RTL) works end-to-end.

Purpose: Create stable anchor points for driver.js tour steps, and confirm all Phase 1 infrastructure renders correctly before subsequent phases build on it.
Output: 7 data-tour attributes on existing elements, visual verification of driver.js CSS in light/dark and RTL modes.
</objective>

<execution_context>
@/home/erfan/.claude/get-shit-done/workflows/execute-plan.md
@/home/erfan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

Key reference files:
@src/components/CourseSearch.tsx
@src/components/WeeklySchedule.tsx
@src/components/ScheduleTabs.tsx
@src/components/ExportButtons.tsx
@src/App.tsx
@src/components/onboarding/steps.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add data-tour attributes to 7 target elements</name>
  <files>
    src/components/CourseSearch.tsx
    src/components/WeeklySchedule.tsx
    src/components/ScheduleTabs.tsx
    src/components/ExportButtons.tsx
    src/App.tsx
  </files>
  <action>
Add `data-tour` attributes to the outermost wrapper elements of each component. These are stable selectors for driver.js tour steps. Do NOT target FullCalendar internal elements.

**Read each file first**, then add the attribute to the correct element:

1. **`src/components/CourseSearch.tsx`** -- Add `data-tour="course-search"` to the outermost `<div>` wrapper (the one with `className="flex flex-col gap-3"`).

2. **`src/components/WeeklySchedule.tsx`** -- Add `data-tour="calendar"` to the outermost `<div>` wrapper (the one with `className="bg-white dark:bg-gray-800 rounded-xl..."`). This is the wrapper around the FullCalendar component, NOT a FullCalendar internal element.

3. **`src/components/ScheduleTabs.tsx`** -- Add `data-tour="schedule-tabs"` to the outermost `<div>` wrapper (the one with `className="flex items-center gap-2 flex-wrap"`).

4. **`src/components/ExportButtons.tsx`** -- Add `data-tour="export-buttons"` to the outermost `<div>` wrapper (the one with `className="flex items-center gap-1.5"`).

5. **`src/App.tsx`** -- Add three `data-tour` attributes:
   a. `data-tour="mobile-add-btn"` on the mobile FAB button (the `<button>` with `className="fixed bottom-5 right-4 bg-primary-600..."` and text "افزودن درس" or "+").
   b. `data-tour="exams-toggle"` on the exams toggle button (the `<button>` with `onClick={() => setShowExams(...)}` or similar toggle handler).
   c. `data-tour="dark-mode"` on the dark mode toggle button (the `<button>` with `onClick={toggleDark}` or similar).

**Rules:**
- Add `data-tour` as the first attribute after the opening `<` tag (before className) for consistency and visibility
- Do NOT change any existing attributes, class names, or behavior
- Do NOT add data-tour to elements inside third-party libraries (FullCalendar)
- Each attribute value must exactly match the `targetSelector` values in steps.ts (without the `[data-tour="..."]` wrapper)
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Grep for `data-tour=` across modified files shows exactly 7 occurrences:
   - `grep -r 'data-tour=' src/components/CourseSearch.tsx` → 1 match
   - `grep -r 'data-tour=' src/components/WeeklySchedule.tsx` → 1 match
   - `grep -r 'data-tour=' src/components/ScheduleTabs.tsx` → 1 match
   - `grep -r 'data-tour=' src/components/ExportButtons.tsx` → 1 match
   - `grep -r 'data-tour=' src/App.tsx` → 3 matches
4. Each `data-tour` value matches the corresponding `targetSelector` in `src/components/onboarding/steps.ts`
  </verify>
  <done>7 data-tour attributes placed on correct wrapper elements across 5 files. Build and type-check pass. No behavioral or layout changes.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visually verify Phase 1 infrastructure</name>
  <files>
    src/components/onboarding/driver-overrides.css
    src/index.css
  </files>
  <action>
**What was built:** Complete Phase 1 foundation -- driver.js installed, CSS overrides for dark mode + RTL + Vazirmatn font, persistence atom, tour steps data, and data-tour attributes on all target elements.

**How to verify:**

1. Start dev server: `npm run dev`
2. Open the app in browser (localhost:5173 or similar)

**Verify data-tour attributes:**
3. Open DevTools - Elements tab
4. Search for `data-tour` -- should find 7 elements (may only see 4-5 on desktop since mobile FAB is conditionally rendered)
5. Confirm no layout or visual changes -- the app should look identical to before

**Verify driver.js CSS loads (quick console test):**
6. In DevTools Console, run:
   ```javascript
   import('driver.js').then(({driver}) => {
     const d = driver({
       showProgress: true,
       steps: [
         { element: '[data-tour="schedule-tabs"]', popover: { title: 'تست', description: 'این یک تست است.', side: 'bottom', align: 'start' } },
         { element: '[data-tour="calendar"]', popover: { title: 'برنامه', description: 'برنامه هفتگی شما.', side: 'top', align: 'center' } }
       ]
     });
     d.drive();
   });
   ```
7. A spotlight overlay should appear with a popover card
8. Popover should show Persian text in Vazirmatn font (same as rest of app)
9. Text should be right-aligned (RTL)
10. Navigation buttons should be in correct RTL order (Next on the left side)

**Verify dark mode:**
11. Toggle dark mode using the app's dark mode button
12. The popover should switch to dark background (#1e293b) with light text
13. Arrow should match the dark popover background (no white arrow tip)
14. Click "Next" to advance and verify the second step also renders correctly in dark mode

**Verify persistence atom:**
15. In DevTools Console, run: `localStorage.getItem('plan-onboarding-v1')` -- should return `null` (not yet set) or `"false"`

**Resume signal:** Type "approved" if everything renders correctly, or describe any visual issues (arrow color mismatch, font wrong, RTL alignment off, etc.)
  </action>
  <verify>User confirms visual correctness of driver.js popover in both light/dark mode and RTL layout.</verify>
  <done>Human verified: driver.js popovers render with Vazirmatn font, RTL text alignment, correct dark mode colors, and matching arrow colors. No visual regressions in existing app.</done>
</task>

</tasks>

<verification>
1. All 7 `data-tour` attributes present on correct elements
2. `npm run build` passes cleanly
3. driver.js test popover renders with:
   - Persian text in Vazirmatn font
   - RTL text alignment and button order
   - Correct dark mode colors (background, text, arrows)
4. No visual regressions in the app
5. `localStorage` key `plan-onboarding-v1` follows project convention
</verification>

<success_criteria>
- 7 data-tour attributes on correct stable wrapper elements (not FullCalendar internals)
- No layout or behavioral changes to existing app
- driver.js popover visually confirmed: Vazirmatn font, RTL layout, dark mode colors, arrow colors
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
