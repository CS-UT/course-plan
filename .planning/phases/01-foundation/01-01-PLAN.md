---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/components/onboarding/driver-overrides.css
  - src/index.css
  - src/components/onboarding/steps.ts
  - src/components/onboarding/index.ts
  - src/atoms/index.ts
autonomous: true

must_haves:
  truths:
    - "driver.js is installed as a project dependency and importable"
    - "driver.js CSS renders correctly alongside Tailwind v4 (unlayered, before Tailwind import)"
    - "Dark mode CSS overrides exist for driver.js popovers (background, text, arrows)"
    - "RTL CSS overrides exist for driver.js popovers (direction, text-align, button order)"
    - "Vazirmatn font is applied to driver.js popovers via CSS"
    - "A Jotai atom persists onboarding state to localStorage with versioned key plan-onboarding-v1"
    - "Tour step definitions exist as a pure data array in steps.ts with Persian text"
    - "Barrel export re-exports steps.ts contents"
  artifacts:
    - path: "src/components/onboarding/driver-overrides.css"
      provides: "driver.js base CSS import + dark mode + RTL + font overrides"
      contains: "@import \"driver.js/dist/driver.css\""
    - path: "src/components/onboarding/steps.ts"
      provides: "Tour step definitions with selectors, Persian text, placement, device"
      exports: ["tourSteps", "TourStepDef"]
    - path: "src/components/onboarding/index.ts"
      provides: "Barrel export for onboarding module"
      exports: ["tourSteps", "TourStepDef"]
    - path: "src/atoms/index.ts"
      provides: "onboardingCompletedAtom with plan-onboarding-v1 key"
      contains: "onboardingCompletedAtom"
  key_links:
    - from: "src/index.css"
      to: "src/components/onboarding/driver-overrides.css"
      via: "@import before tailwindcss"
      pattern: '@import.*driver-overrides.*css'
    - from: "src/components/onboarding/driver-overrides.css"
      to: "driver.js/dist/driver.css"
      via: "@import for base styles"
      pattern: '@import.*driver\\.js/dist/driver\\.css'
    - from: "src/atoms/index.ts"
      to: "localStorage"
      via: "atomWithStorage with versioned key"
      pattern: "atomWithStorage.*plan-onboarding-v1"
---

<objective>
Install driver.js, create CSS overrides for dark mode + RTL + Vazirmatn font, set up Jotai persistence atom, and create tour step data file with Persian content.

Purpose: Establish all infrastructure files so Phase 2 (Welcome Modal) and Phase 3 (Coach Marks Tour) can build on a working CSS/state/data foundation.
Output: driver.js installed, CSS override file with dark/RTL/font overrides, persistence atom, tour steps data file, barrel export.
</objective>

<execution_context>
@/home/erfan/.claude/get-shit-done/workflows/execute-plan.md
@/home/erfan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md

Key reference files:
@src/index.css
@src/atoms/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install driver.js and create CSS override file</name>
  <files>
    package.json
    package-lock.json
    src/components/onboarding/driver-overrides.css
    src/index.css
  </files>
  <action>
1. Run `npm install driver.js` to add driver.js as a dependency.

2. Create `src/components/onboarding/driver-overrides.css` with the following sections (use exact CSS from research, reproduced here):

   a. **Base import**: `@import "driver.js/dist/driver.css";`

   b. **Font override**: Set `.driver-popover { font-family: "Vazirmatn", system-ui, sans-serif; }` to match the app's --font-sans theme variable.

   c. **Dark mode overrides** using `.dark` selector (matches `@custom-variant dark` in the project):
      - `.dark .driver-popover`: background `#1e293b` (slate-800), color `#e2e8f0` (slate-200)
      - `.dark .driver-popover-title`: color `#f1f5f9` (slate-100)
      - `.dark .driver-popover-description`: color `#cbd5e1` (slate-300)
      - `.dark .driver-popover-close-btn`: color `#94a3b8` (slate-400)
      - `.dark .driver-popover-footer .driver-popover-progress-text`: color `#94a3b8`
      - `.dark .driver-popover-navigation-btns button`: transparent bg, color `#94a3b8`, border `#475569` (slate-600)
      - `.dark .driver-popover-navigation-btns .driver-popover-next-btn`: bg `#3b82f6` (blue-500/primary-500), white text, border `#3b82f6`
      - All four arrow directions in dark mode, each pointing to `#1e293b`:
        - `.dark .driver-popover-arrow-side-top { border-bottom-color: #1e293b; }`
        - `.dark .driver-popover-arrow-side-bottom { border-top-color: #1e293b; }`
        - `.dark .driver-popover-arrow-side-left { border-right-color: #1e293b; }`
        - `.dark .driver-popover-arrow-side-right { border-left-color: #1e293b; }`

   d. **RTL overrides** using `[dir="rtl"]` selector (matches `<html dir="rtl">` in index.html):
      - `[dir="rtl"] .driver-popover { direction: rtl; text-align: right; }`
      - `[dir="rtl"] .driver-popover-footer { flex-direction: row-reverse; }`
      - `[dir="rtl"] .driver-popover-navigation-btns { flex-direction: row-reverse; }`
      - `[dir="rtl"] .driver-popover-close-btn { left: unset; right: 8px; }`
      - `[dir="rtl"] .driver-popover-progress-text { direction: rtl; }`

3. Update `src/index.css` to import the override file BEFORE `@import "tailwindcss"` but AFTER the Google Fonts import:
   ```css
   @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100..900&display=swap');
   @import "./components/onboarding/driver-overrides.css";
   @import "tailwindcss";
   ```

**CRITICAL**: Do NOT use `@import` inside a Tailwind `@layer`. Both driver.js CSS and overrides must remain unlayered so they have higher specificity than Tailwind's layered utilities. Do NOT use `!important` anywhere.

**NOTE on @import resolution**: Vite resolves bare module specifiers in CSS `@import` via node_modules. `@import "driver.js/dist/driver.css"` should work. If build fails, switch to relative path `@import "../../../node_modules/driver.js/dist/driver.css"` -- but try bare specifier first.
  </action>
  <verify>
1. `npm ls driver.js` shows driver.js installed (^1.4.x or similar)
2. File `src/components/onboarding/driver-overrides.css` exists and contains `@import "driver.js/dist/driver.css"`
3. `src/index.css` has the driver-overrides import BEFORE `@import "tailwindcss"`
4. `npm run build` succeeds without CSS import errors
5. `npx tsc --noEmit` passes (no TypeScript errors introduced)
  </verify>
  <done>driver.js installed, CSS override file created with dark mode + RTL + font overrides, index.css import order correct, build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Create tour step definitions, barrel export, and persistence atom</name>
  <files>
    src/components/onboarding/steps.ts
    src/components/onboarding/index.ts
    src/atoms/index.ts
  </files>
  <action>
1. Create `src/components/onboarding/steps.ts` as a **pure data file** (no imports, no side effects):

   a. Export a `TourStepDef` interface:
      ```typescript
      export interface TourStepDef {
        id: string;
        targetSelector: string;
        title: string;
        description: string;
        side: 'top' | 'bottom' | 'left' | 'right';
        align: 'start' | 'center' | 'end';
        device: 'desktop' | 'mobile' | 'both';
      }
      ```

   b. Export a `tourSteps` array of type `TourStepDef[]` with these 7 steps (use exact Persian text from research):

      | id | targetSelector | title | description | side | align | device |
      |---|---|---|---|---|---|---|
      | course-search | `[data-tour="course-search"]` | جستجوی درس | از اینجا دروس مورد نظرتان را جستجو کنید و به برنامه اضافه کنید. | left | start | desktop |
      | mobile-add | `[data-tour="mobile-add-btn"]` | افزودن درس | برای جستجو و افزودن درس، اینجا را لمس کنید. | top | center | mobile |
      | calendar | `[data-tour="calendar"]` | برنامه هفتگی | برنامه هفتگی شما اینجا نمایش داده می‌شود. روی خانه‌های خالی بکشید تا دروس آن ساعت فیلتر شوند. | top | center | both |
      | schedule-tabs | `[data-tour="schedule-tabs"]` | برنامه‌های متعدد | می‌توانید تا ۵ برنامه مختلف بسازید و مقایسه کنید. | bottom | start | both |
      | exams-toggle | `[data-tour="exams-toggle"]` | جدول امتحانات | جدول امتحانات و تداخل‌ها را اینجا ببینید. | bottom | start | both |
      | export-buttons | `[data-tour="export-buttons"]` | خروجی و اشتراک‌گذاری | برنامه را به صورت تصویر، فایل JSON یا لینک تقویم گوگل خروجی بگیرید. | bottom | end | both |
      | dark-mode | `[data-tour="dark-mode"]` | حالت تاریک | با این دکمه بین حالت روشن و تاریک جابه‌جا شوید. | bottom | end | both |

2. Create `src/components/onboarding/index.ts` as a barrel export:
   ```typescript
   // Onboarding module — components will be added in Phase 2-4
   export { tourSteps } from './steps';
   export type { TourStepDef } from './steps';
   ```

3. Add the onboarding persistence atom to `src/atoms/index.ts`:
   - Import is already present for `atomWithStorage` (existing import)
   - Add: `export const onboardingCompletedAtom = atomWithStorage<boolean>('plan-onboarding-v1', false);`
   - Place it after the existing `slotFilterAtom` export
   - Key format follows existing convention: `plan-` prefix + `-v1` version suffix for future reset capability
  </action>
  <verify>
1. `npx tsc --noEmit` passes with no errors
2. File `src/components/onboarding/steps.ts` exists and exports `tourSteps` (array of 7 items) and `TourStepDef`
3. File `src/components/onboarding/index.ts` re-exports from steps.ts
4. `src/atoms/index.ts` exports `onboardingCompletedAtom`
5. Grep for `plan-onboarding-v1` in atoms/index.ts confirms versioned key
  </verify>
  <done>Tour step definitions file with 7 Persian-language steps, barrel export, and Jotai persistence atom with versioned localStorage key all created and type-check clean.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors (CSS imports resolve, TypeScript compiles)
2. `npx tsc --noEmit` passes
3. `npm ls driver.js` shows driver.js installed
4. `src/components/onboarding/` directory contains: `driver-overrides.css`, `steps.ts`, `index.ts`
5. `src/index.css` imports driver-overrides.css before tailwindcss
6. `src/atoms/index.ts` exports `onboardingCompletedAtom` with key `plan-onboarding-v1`
</verification>

<success_criteria>
- driver.js is an installed npm dependency
- CSS override file contains dark mode overrides (`.dark .driver-popover`), RTL overrides (`[dir="rtl"] .driver-popover`), Vazirmatn font override, and all four arrow direction dark mode colors
- CSS import order in index.css: Google Fonts -> driver-overrides.css -> tailwindcss
- steps.ts exports 7 tour steps with Persian text, target selectors, placement, and device flags
- Jotai atom uses `atomWithStorage` with key `plan-onboarding-v1` and default `false`
- Full project builds and type-checks cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
