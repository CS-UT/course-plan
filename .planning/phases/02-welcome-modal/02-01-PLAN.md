---
phase: 02-welcome-modal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/onboarding/welcomeSlides.ts
  - src/components/onboarding/WelcomeModal.tsx
  - src/components/onboarding/index.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "First-time visitor (no localStorage flag) sees a centered modal with semi-transparent backdrop showing 4 feature slides"
    - "Each slide has a Persian headline and description, navigable via dot indicators, Next button, or touch swipe"
    - "User can click 'Start Tour' on the last slide to dismiss the modal (sets onboardingCompletedAtom true) and trigger onStartTour callback"
    - "User can click 'Skip' on any slide to dismiss the modal (sets onboardingCompletedAtom true) without triggering the tour"
    - "Modal renders correctly on mobile (< 640px) and desktop viewports, and matches active theme (light or dark)"
    - "Returning visitor (localStorage flag set) never sees the welcome modal"
  artifacts:
    - path: "src/components/onboarding/welcomeSlides.ts"
      provides: "Slide content data (4 slides with Persian headlines, descriptions, emoji icons)"
      exports: ["welcomeSlides", "WelcomeSlide"]
    - path: "src/components/onboarding/WelcomeModal.tsx"
      provides: "Welcome carousel modal component with slide navigation, dot indicators, swipe, Skip/Next/Start Tour buttons"
      exports: ["WelcomeModal"]
    - path: "src/components/onboarding/index.ts"
      provides: "Barrel export for WelcomeModal and welcomeSlides"
      contains: "export.*WelcomeModal"
    - path: "src/App.tsx"
      provides: "WelcomeModal rendered at app root, gated by onboardingCompletedAtom"
      contains: "WelcomeModal"
  key_links:
    - from: "src/components/onboarding/WelcomeModal.tsx"
      to: "src/atoms/index.ts"
      via: "useAtom(onboardingCompletedAtom) for gating display and persisting dismissal"
      pattern: "useAtom.*onboardingCompletedAtom"
    - from: "src/components/onboarding/WelcomeModal.tsx"
      to: "src/components/onboarding/welcomeSlides.ts"
      via: "imports welcomeSlides array for slide content"
      pattern: "import.*welcomeSlides"
    - from: "src/App.tsx"
      to: "src/components/onboarding/WelcomeModal.tsx"
      via: "renders <WelcomeModal onStartTour={...} />"
      pattern: "<WelcomeModal"
---

<objective>
Build the welcome carousel modal that first-time visitors see on their initial visit. The modal shows 4 feature slides (search, schedule, compare, export) with Persian text, dot indicators, touch swipe support, and Skip/Start Tour actions. Dismissal persists via the existing `onboardingCompletedAtom`.

Purpose: Convert the onboarding foundation (Phase 1) into the first user-facing onboarding touchpoint. First-time users get a polished introduction to app features before optionally entering the interactive tour.
Output: Working `WelcomeModal` component rendered in `App.tsx`, visible to first-time visitors, dismissable via Skip or Start Tour.
</objective>

<execution_context>
@/home/erfan/.claude/get-shit-done/workflows/execute-plan.md
@/home/erfan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-welcome-modal/02-RESEARCH.md

@src/components/onboarding/index.ts
@src/components/onboarding/steps.ts
@src/atoms/index.ts
@src/App.tsx
@src/components/ManualCourseModal.tsx (modal pattern reference -- lines 60-63 for backdrop/card structure)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create welcome slides data file and WelcomeModal component</name>
  <files>
    src/components/onboarding/welcomeSlides.ts
    src/components/onboarding/WelcomeModal.tsx
    src/components/onboarding/index.ts
  </files>
  <action>
**1. Create `src/components/onboarding/welcomeSlides.ts`:**

Export a `WelcomeSlide` interface and `welcomeSlides` array with 4 slides. Each slide has: `id` (string), `title` (Persian headline), `description` (Persian 1-2 sentence description), `icon` (emoji string).

Slide content:
- `search`: title="Ø¬Ø³ØªØ¬Ùˆ Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø³", description="Ø¯Ø±ÙˆØ³ Ø±Ø§ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø§ ÛŒÚ© Ú©Ù„ÛŒÚ© Ø¨Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒâ€ŒØªØ§Ù† Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.", icon="ðŸ”"
- `schedule`: title="Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯", description="ØªØ¯Ø§Ø®Ù„ Ø³Ø§Ø¹Øª Ùˆ Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.", icon="ðŸ“…"
- `compare`: title="Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§", description="ØªØ§ Ûµ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø®ØªÙ„Ù Ø¨Ø³Ø§Ø²ÛŒØ¯ Ùˆ Ø¨Ù‡ØªØ±ÛŒÙ† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.", icon="ðŸ“Š"
- `export`: title="Ø®Ø±ÙˆØ¬ÛŒ Ùˆ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ", description="Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª ØªØµÙˆÛŒØ± Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ø§ Ø¯ÙˆØ³ØªØ§Ù†ØªØ§Ù† Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯.", icon="ðŸ“¤"

**2. Create `src/components/onboarding/WelcomeModal.tsx`:**

Follow the exact component skeleton from the research file (02-RESEARCH.md, "WelcomeModal Component Skeleton" section). Key implementation details:

- **Props:** `{ onStartTour: () => void }` -- callback for Phase 3 integration
- **State:** `useAtom(onboardingCompletedAtom)` for gating + persistence, `useState(0)` for currentSlide, `useRef(0)` for touchStartX
- **Early return:** If `completed` is true, return `null` (no render for returning users)
- **Modal backdrop:** `fixed inset-0 z-50 bg-black/30 flex items-center justify-center p-4` -- matches ManualCourseModal pattern. Do NOT add `onClick={dismiss}` on backdrop (intentional first-time content, no accidental dismiss)
- **Card:** `bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 w-full max-w-sm overflow-hidden` with `onClick={e => e.stopPropagation()}`
- **Slide container:** `overflow-hidden` wrapper with touch handlers. Inner flex div with `transition-transform duration-300 ease-in-out` and `style={{ transform: \`translateX(${currentSlide * 100}%)\` }}` -- **positive translateX for RTL** (forward = positive X)
- **Each slide:** `w-full flex-shrink-0 p-6 text-center` containing icon (text-4xl mb-3), title (text-lg font-bold text-gray-900 dark:text-gray-100 mb-2), description (text-sm text-gray-600 dark:text-gray-400 leading-relaxed)
- **Dot indicators:** Row of buttons below slides. Active: `bg-primary-500`, inactive: `bg-gray-300 dark:bg-gray-600`. Each `w-2 h-2 rounded-full transition-colors cursor-pointer`. Clickable to jump to slide.
- **Action buttons row:** `flex items-center justify-between px-6 pb-5`
  - Left: "Ø±Ø¯ Ø´Ø¯Ù†" (Skip) button -- `text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 cursor-pointer`. Calls `handleSkip` which sets `completed=true`.
  - Right: On last slide show "Ø´Ø±ÙˆØ¹ Ø±Ø§Ù‡Ù†Ù…Ø§" (Start Tour) button, on other slides show "Ø¨Ø¹Ø¯ÛŒ" (Next). Both: `px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white text-sm font-medium rounded-xl transition-colors cursor-pointer`.
- **Touch swipe:** `onTouchStart` saves `e.touches[0].clientX` to ref. `onTouchEnd` calculates delta. If delta < -50, go next. If delta > 50, go prev. Standard physical gesture direction (works same in LTR and RTL).
- **goToSlide helper:** Clamps index to `[0, slides.length - 1]`
- **Both Skip and Start Tour MUST call `setCompleted(true)`** before their respective actions (dismiss vs. dismiss + onStartTour)

**3. Update `src/components/onboarding/index.ts`:**

Add exports for the new files:
```typescript
export { tourSteps } from './steps';
export type { TourStepDef } from './steps';
export { WelcomeModal } from './WelcomeModal';
export { welcomeSlides } from './welcomeSlides';
export type { WelcomeSlide } from './welcomeSlides';
```
  </action>
  <verify>
Run `npx tsc --noEmit` -- zero type errors. Verify the 3 files exist and have correct exports:
- `welcomeSlides.ts` exports `WelcomeSlide` interface and `welcomeSlides` array of length 4
- `WelcomeModal.tsx` exports `WelcomeModal` component
- `index.ts` re-exports both
  </verify>
  <done>
Three files created with zero type errors. WelcomeModal component reads onboardingCompletedAtom, renders 4 slides with CSS transform carousel, has dot indicators, touch swipe, Skip button, and Next/Start Tour button. Barrel export updated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate WelcomeModal into App.tsx and verify end-to-end</name>
  <files>
    src/App.tsx
  </files>
  <action>
**1. Add WelcomeModal to App.tsx:**

- Import `WelcomeModal` from `@/components/onboarding` (use barrel import)
- Add a `handleStartTour` callback function in the `App` component. For now (Phase 2), this is a placeholder that logs to console: `console.log('Tour requested -- will be wired in Phase 3/4');`. It will be replaced by the actual driver.js tour launch in Phase 3/4.
- Render `<WelcomeModal onStartTour={handleStartTour} />` inside the App component. Place it at the END of the returned JSX (after all other content, before the closing fragment/div), so it renders on top as a fixed overlay. It does not need to be inside any specific container since it uses `fixed inset-0`.

**2. Verify the integration works end-to-end:**

- Run `npm run build` to confirm production build succeeds with zero errors
- Run `npm run dev` in background, then use Playwright or curl to confirm the dev server starts
- Clear localStorage key `plan-onboarding-v1` (or use incognito concept) to simulate first-time visitor
- Verify the modal renders on page load for first-time visitors
- Verify clicking through slides works (dot indicators, Next button)
- Verify "Skip" dismisses and sets localStorage
- Verify after dismissal, page reload does NOT show modal again

**Important:** Do NOT modify the existing dark mode logic, schedule state, or any other App.tsx functionality. This is an additive change only.
  </action>
  <verify>
Run `npm run build` -- zero errors, zero warnings. Run `npm run lint` -- no new lint errors. The WelcomeModal import and render are present in App.tsx. `npx tsc --noEmit` passes.
  </verify>
  <done>
WelcomeModal is rendered in App.tsx. Production build passes. First-time visitors see the modal; returning visitors (localStorage flag set) do not. The onStartTour callback is wired with a placeholder for Phase 3/4 integration.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- zero type errors across the project
2. `npm run build` -- production build succeeds
3. `npm run lint` -- no new lint errors
4. First-time visitor (no `plan-onboarding-v1` in localStorage) sees the welcome modal with 4 slides
5. Each slide shows Persian headline, description, and emoji icon
6. Dot indicators navigate between slides; "Next" button advances; touch swipe works
7. "Skip" button dismisses modal and sets `plan-onboarding-v1` to `true` in localStorage
8. "Start Tour" button on last slide dismisses modal, sets localStorage, and calls onStartTour
9. Page reload after dismissal does NOT show the modal again
10. Modal looks correct in both light and dark mode
11. Modal is responsive -- works on mobile (< 640px) and desktop viewports
</verification>

<success_criteria>
- WelcomeModal component exists at src/components/onboarding/WelcomeModal.tsx with full carousel functionality
- welcomeSlides.ts provides 4 Persian-language feature slides
- App.tsx renders WelcomeModal with onStartTour callback
- Build passes, typecheck passes, lint passes
- Modal appears for first-time visitors and stays dismissed for returning visitors
</success_criteria>

<output>
After completion, create `.planning/phases/02-welcome-modal/02-01-SUMMARY.md`
</output>
